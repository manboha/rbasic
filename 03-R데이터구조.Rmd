# R 데이터 구조

## R 벡터 Vector

벡터란 동일한 형태(예, 숫자 또는 문자)의 데이터 값들이 나열되어 있는 데이터 구조입니다.

### 벡터 만들기

#### c() 함수로 벡터 만들기

```{r}
# 변수 v1에 숫자 1, 2, 3을 할당
v1 <- c(1, 2, 3)  
v2 <- c(4, 5, 6)  
v1; v2
```

```{r}
# 변수 v3에 변수 v1과 v2의 값들을 결합하여 할당
v3 <- c(v1, v2)   
v3
```

```{r}
# 변수 s1에 문자열 벡터인 "대한", "민국", "행정"을 할당
s1 <- c("대한", "민국", "행정")  
s1
```

#### 연속적인 숫자로 벡터 만들기

```{r}
# 콜론(:)을 이용해 연속 숫자가 들어 있는 변수 만들기
var1 <- c(1:5)   # 1~5까지의 연속 값
var1
```

```{r}
# seq() 함수를 이용해 연속 숫자가 들어 있는 변수 만들기
var2 <- seq(1, 5)   # 1~5까지의 연속 값
var2
```

```{r}
# seq() 함수의 by 옵션을 이용해 일정한 간격의 연속 숫자가 들어 있는 변수 만들기
var3 <- seq(1, 10, by = 2)   # 1~10까지 2간격의 연속 값
var4 <- seq(1, 10, by = 3)   # 1~10까지 3간격의 연속 값
var5 <- seq(from = 1.0, to = 2.0, length.out = 5)
var3; var4; var5
```

```{r}
# rep() 함수를 이용해 반복값이 들어있는 변수 만들기
var6 <- rep(5, times = 7)  # 5를 7번 반복 
var7 <- rep(c("a", "b"), each = 3)  # 각 문자 3번 반복
var6; var7
```

#### 벡터 요소 값에 이름 부여 

```{r}
# names() 함수를 이용해 값마다 이름 부여
mscore <- c(95, 85, 75)
names(mscore) <- c("김철수", "이영희", "홍길동")
mscore
```

### 벡터 요소 추출

벡터 안에 들어있는 값들을 요소라고 부릅니다. 

#### 특정 위치에 있는 요소 추출

벡터 내의 특정 위치에 있는 요소를 불러오려면 벡터명[번호]라고 하면 됩니다.

```{r}
v <- c(11, 12, 13, 14, 15)
w <- c(1, 2, 3, 4, 5)
v[1]
v[2:3]
v[c(1, 3, 5)]
w[seq(1, 5, 2)]  # 홀수번째 값 출력
```

#### 이름으로 요소 추출

```{r}
mscore <- c(95, 85, 75)
names(mscore) <- c("김철수", "이영희", "홍길동")

mscore["이영희"]
```

#### 마이너스 기호(-)를 이용하여 요소 제외

```{r}
# -를 사용하면 원하지 않는 값을 제외할 수 있음
v[-2]
w[-c(3:4)]
```

#### 조건으로 요소 추출

```{r}
s <- c(3, 1, 5, 9, 7, 10)

# 5보다 큰 값을 골라내 부분 벡터로 추출
s[s >= 5] 

# 8보다 큰 값을 골라내 부분 벡터로 추출
subset(s, s >= 8)

# s에서 8보다 큰 element를 가진 index를 리턴
which(s >= 8) 
```

### 벡터 연산

```{r}
v <- c(11, 12, 13, 14, 15)
w <- c(1, 2, 3, 4, 5)

v[1] + w[5]   # 11+5=16
v + w         # 11+1, 12+2, ...
v * w         # 11*1, 12*2, ... 
w + 2         # 1+2, 2+2, ...
w - mean(w)   # 1-평균, 2-평균, ...
sqrt(w)       # sqrt(1), sqrt(2), ...
sum(w)        # 1+2+3+4+5
```

### 기타

#### 벡터 길이 측정

```{r}
length(v)
```

#### 벡터 결측값

```{r}
# 결측값이 있는 벡터 생성
have_child <- c(김철수 = "yes", 이영철 = "yes", 
                홍길동 = NA, 김연아 = NA)

# 결측값 유무 검사
is.na(have_child)
```


## R 행렬 Matrix

동일한 형태의 데이터가 2차원으로 구성된 데이터 구조입니다. 표처럼 m × n 형태로 이루어진 데이터 구조입니다. 

### 행렬 생성

#### matrix()를 사용하여 행렬 생성

```{r}
# 1부터 12까지의 숫자를 3개열 형태의 행렬로 만들어 변수 m1에 할당
# ncol : 열의 수
m1 <- matrix(1:12, ncol = 3)
m1
```

```{r}
# nrow : 행의 수
# byrow : FALSE(기본값)이면 행렬이 열로 채워지고 그렇지 않으면 행렬이 행으로 채워짐
m2 <- matrix(
  data = c(1,2,3, 11,12,13),
  nrow = 2, byrow = TRUE
  )
m2
```

#### cbind() 또는 rbind()를 사용하여 행렬 생성

```{r}
# 숫자 벡터 생성
col1 <- c(5, 6, 7, 8, 9)
col2 <- c(2, 4, 5, 9, 8)
col3 <- c(7, 3, 4, 8, 7)
# 열 기준으로 벡터 병합 
m3 <- cbind(col1, col2, col3)
m3
```

### 행렬 이름 붙이기

#### rownames() 또는 colnames()를 사용하여 이름 붙이기

```{r}
rownames(m3) <- c("행1", "행2", "행3", "행4", "행5")
colnames(m3) <- c("열1", "열2", "열3")
m3
```

#### matrix()의 dimnames 속성을 이용하여 이름 붙이기

```{r}
m4 <- matrix(
  data = c(1,2,3, 11,12,13),
  nrow = 2, byrow = TRUE,
  dimnames = list(c("행1", "행2"), c("일열", "이열", "삼열"))
  )
m4
```

### 행열 바꾸기

```{r}
t(m2)
```

### 행렬의 차원

```{r}
# 행의 갯수
nrow(m3)

# 열의 갯수
ncol(m3)

# 행과 열이 갯수
dim(m3)
```

### 행렬의 요소 추출

#### 특정 위치에 있는 요소 추출

```{r}
# 2번째 행에 있는 요소 추출
m3[2,]
```

```{r}
# 2행 3열에 있는 요소 추출
m3[2, 3]
```

```{r}
# 2행에서 3행 추출
m3[2:3,]
```

```{r}
# 2행과 5행 추출
m3[c(2,5),]
``` 

#### 행렬 이름으로 요소 추출

```{r}
# 두번째 열 추출
m3[, "열2"]
```

```{r}
# 세번째 행 추출
m3["행3",]
```

#### 마이너스 기호(-)를 이용하여 요소 제외

```{r}
# 2행과 2열 제외
m3[-2, -2]
```

#### 조건으로 요소 추출

```{r}
# 3열의 값이 5이상인 경우 추출
col3 <- m3[, 3]
m3[col3 >= 5,]
```

```{r}
# 5보다 큰 수 모두 추출
m3[m3 > 5]

# 짝수만 추출
m3[m3 %% 2 == 0]
```

### 행렬 요소 수정

```{r}
# 하나의 요소 값 수정
mm <- m3; mm
mm[2, 2] <- 9; mm
```

```{r}
# 5미만 인 경우 0으로 수정
mm[mm < 6] <- 0; mm
```

### 행렬 연산

```{r}
m1 * 2
```

```{r}
log2(m1)
```

```{r}
# 행합계 rowSums() 
rowSums(m3)

# 열합계 colSums()
colSums(m3)
```

```{r}
# 행 평균
apply(m3, 1, mean)

# 열 평균
apply(m3, 2, mean)
```

* 행렬곱 %*%

행열간의 곱하기는 수학적으로 곱이 가능한 형태를 갖는 행렬만이 가능합니다.

```{r}
x <- matrix(1:9, nrow = 3)
y <- matrix(11:19, nrow = 3)
x %*% y
```


## R 팩터 Factor

범주형(명목형) 자료의 데이터 구조입니다. Levles는 이 팩터(요인)가 가질 수 있는 값들입니다. 예를 들면 성별 데이터는 범주형 데이터로서 팩터 데이터 구조를 가질 수 있는데, "남성"와 "여성"은 Levels라 할 수 있습니다.

R에서 분석을 하다보면 팩터형식의 데이터이어야 하는 경우가 있고, 팩터형식이 아니어야 하는 경우가 있습니다. 상황에 따라 적절한 형식으로 변환하며 사용해야 합니다.

### 팩터 변수 만들기

```{r}
sex <- factor(c("남성", "여성", "여성", "남성", "남성"))
sex
```

```{r}
sex <- c("남성", "여성", "여성", "남성", "남성")
sex <- factor(sex)

# Or
sex <- factor(sex, levels = c("여성", "남성"))
sex
```

```{r}
# 팩터 변수의 levels 보기
levels(sex)
```

팩터는 벡터와 밀접한 관계입니다. 사실상 펙터는 정수 벡터로 저장된 데이터 구조입니다.
아래에서 보듯이 levels는 문자로 저장되어 있으나, 각 요소는 숫자로 저장되어 있습니다. 
1은 여성이고 2는 남성인 것입니다.

```{r}
str(sex)
```

### 팩터 요소 추출

팩터의 요소 추출은 벡터와 유사합니다.

```{r}
sex[3]
sex[c(1, 3)]
sex[-1]
```

### 팩터 요소 수정

팩터 요소의 수정은 벡터와 비슷하나, Levels 값의 범위를 벗어날 수 없습니다.

```{r warning=TRUE}
sex[1] <- "여성"
sex

sex[1] <- "양성"
sex
```

Levels 값의 범위를 벗어난 값을 추가하려면 먼저 새로운 Levels 값을 추가합니다.

```{r}
# 새로운 Levels 값 추가
levels(sex) <- c(levels(sex), "양성")
sex[1] <- "양성"
sex
```

### 기타

#### 팩터 레벨의 순서 변경

팩터 레벨의 순서는 levels 속성에서 정의하여 줍니다.

```{r}
sex <- factor(sex, levels = c("여성", "양성", "남성"))
sex
```

#### 팩터 형식 검사

```{r}
is.factor(sex)
```

#### 팩터 변환

factor()와 as.factor()는 거의 유사하나, 입력 데이터가 이미 factor이거나 vector이면 as.factor()의 속도가 더 빠릅니다.

```{r}
pf <- c(1, 5, 1, 3, 3, 2, 4, 2, 5, 1, 3, 5)
pf <- as.factor(pf)
pf
```

#### 팩터 변수 요약

```{r}
summary(sex)
```


## R 배열 Array

배열은 동일한 형태의 데이터가 2차원 이상으로 구성된 데이터 구조입니다. 벡터가 1차원이고, 행렬은 2차원, 배열은 2차원 이상의 구조입니다. 배열은 행렬을 층층히 쌓으면서 3차원, 4차원, 5차원 등으로 확대할 수 있습니다.

### 배열 생성

```{r}
# 1~24의 숫자를 3x4 행렬의 2층 짜리 배열 만들기
arr1 <- array(1:24, dim = c(3, 4, 2))
arr1
```

### 배열 이름 붙이기

```{r}
# array()의 dimnames 속성을 이용하여 이름 붙이기
arr2 <- array(
  data = 1:24,
  dim = c(4, 3, 2),
  dimnames = list(c("one", "two", "three", "four"),
                  c("ray", "karl", "mimo"),
                  c("steve", "mark")
                  )
  )
arr2
```

### 배열의 요소 추출

#### 특정위치에 있는 요소 추출

```{r}
# 2행, 2열, 2층 요소 추출
arr2[2, 2, 2]

# 각 층의 2행 추출
arr2[2, , ]

# 각층의 3행, 3열 요소 추출
arr2[3, 3, ]

# 2층의 행렬 추출
arr2[,,2]
```

#### 이름으로 요소 추출

```{r}
# 2행(two), 2열(karl), 2층(mark) 요소 추출
arr2["two", "karl", "mark"]

# 각 층의 2행(two) 추출
arr2["two", , ]

# 각층의 3행(three), 3열(mimo) 요소 추출
arr2["three", "mimo", ]

# 2층(mark)의 행렬 추출
arr2[,,"mark"]
```

#### 마이너스 기호(-)를 이용하여 요소 제외

```{r}
# 2행과 2열 제외
arr2[-2, -2, ]
```

#### 조건으로 요소 추출

```{r}
# 11초과인 값 추출
arr2[arr2 > 11]

# 짝수 추출
arr2[arr2 %% 2 == 0]
```

### 배열 요소 수정

```{r}
arr2[2, 2, 1] <- 55
arr2
```

### 배열 연산

```{r}
arr2 * 3
```

```{r}
rowSums(arr2)
colSums(arr2)
```

배열의 차원이 같다면 배열끼리 계산이 가능합니다.

```{r}
ax <- array(1:12, dim = c(2, 3, 2))
ay <- array(11:22, dim = c(2, 3, 2))
ax; ay

ax + ay
ax * ay
ax / ay
ax + (1:2)
```


## R 데이터 프레임 Data frame

데이터 프레임은 다양한 형태의 데이터가 2차원으로 구성된 데이터 구조입니다. 행(케이스)과 열(변수)로 구성된 표와 같이 생겼습니다. 엑셀에서 이름 필드, 연령 필드, 성적 필드 등으로 이루어진 표와 같다고 보면 됩니다. 통계분석에 가장 많이 사용됩니다.


### 데이터 프레임 만들기

데이터 프레임을 생성하는 방법은 많습니다. 그 중에서 가장 많이 쓰이는 방법은 외부에서 만들어진 정리된 데이터를 R에서 읽어 들이는 방법입니다. 이 방법은 R 입출력에서 자세히 다루겠습니다. 

두 번째 방법은 벡터 형식의 자료를 묶어서 데이터 프레임을 만드는 것입니다. 아래 예제는 data.frame 함수를 이용하여 벡터 변수 name, age, sex, score를 하나로 묶어서 데이터 프레임 df를 만들어 보겠습니다.

```{r}
name <- c("유재석", "홍진영", "송가인", "강호동", "이영자", "김종민", "김연아")
age <- c(24, 28, 31, 25, 27, 22, 29)
sex <- c("남", "여", "여", "남", "여", "남", "여")
score <- c(90, 80, 85, 75, 95, 80, 70)

# 'stringsAsFactors = FALSE' 옵션 : 문자 데이터를 팩터로 변환시키지 않음
df <- data.frame(name, age, sex, score, stringsAsFactors = FALSE)
df
```


### 데이터 프레임 구조 보기

```{r}
# 데이터 프레임 구조
str(df)
```

```{r}
# 행 개수
nrow(df)

# 열 개수
ncol(df)
```


### 데이터 프레임 요약 보기

```{r}
summary(df)
```



### 데이터 프레임에서 데이터 추출

#### 특정 위치(행과 열 기준)에 있는 데이터 추출하기

```{r}
# name 열(변수) 데이터 추출
# 데이터프레임과 컬럼사이에 $기호가 사용됨
df$name

# df$name 대신 아래처럼 사용 가능
df[, "name"]

# 첫번째 열(name) 추출
df[, 1]

# 1열과 3열 추출
df[, c(1, 3)]

# name 열(변수)의 3번째 데이터 추출
df$name[3]

# 2~3번째 행 추출
df[2:3, ]

# 연령 변수의 데이터를 추출하여 평균을 구함
# na.rm = TRUE는 missing value를 제외하고 계산함
mean(df$age, na.rm = TRUE)
```

#### 마이너스 기호(-)를 이용하여 데이터 제외

```{r}
# 3번째 열 제외
df[, -3]
```

#### 조건으로 데이터 추출

특정 조건에 맞는 데이터만 추출할 때 대괄호 안에 조건식을 입력하여 추출하거나 subset 함수를 이용하여 추출할 수 있습니다. 데이터가 매우 많을 경우에는 대괄호 안에 조건식을 입력하여 추출하는 것이 subset 함수를 이용하는 것 보다 더 빠릅니다.

##### 대괄호 안에 조건식 입력하여 추출

```{r}
# score가 90이상인 데이터 추출
df[df$score >= 90, ]

# score가 90이상인 데이터의 name과 age만 추출
# 1:2 대신 c("name", "age")를 사용해도 됨
df[df$score >= 90, 1:2]

# 조건식과 출력 컬럼명을 변수에 입력하고 이를 활용
score90 <- df$score >= 90
cols <- c("name", "age")
df[score90, cols]
```

##### subset()을 이용하여 추출

```{r}
# score가 90이상인 데이터 추출
subset(df, score >= 90)

# score가 90이상인 데이터의 name과 age만 추출
subset(df, score >= 90, select = c("name", "age"))

# score가 90이상인 데이터에서 age와 sex만 제외하고 추출
subset(df, score >= 90, select = -(age:sex))
```

### 데이터 프레임의 데이터 수정

```{r}
# 2번째 행에 있는 홍진영의 age를 29로 수정
df$age[2] <- 29
df

# 3행에 있는 송가인의 score를 95로 수정
df[3, "score"] <- 95
df
```

### 데이터 프레임 구조 수정

#### 데이터 프레임 행열 추가

##### 행 추가

```{r}
new_data <- list("김남준", 24, "남", 92)
new_data
df <- rbind(df, new_data)
df

new_data <- data.frame(
  name = "이지은",
  age = 26,
  sex = "여",
  score = 93)

df <- rbind(df, new_data)
df
```

##### 열 추가

```{r}
# salary 열 추가
df$salary <- c(220, 180, 250, 170, 220, 270, 250, 290, 210)
df

# 또는 cbind를 활용할 수 있음
# salary 열 추가
salary2 <- c(220, 180, 250, 170, 220, 270, 250, 290, 210)
df <- cbind(df, salary2)
df
```

```{r}
salary3 <- c(220, 180, 250, 170, 220, 270, 250, 290, 210)
new_data <- data.frame(salary3)

df <- cbind(df, new_data)
df
```

#### 데이터 프레임 행열 삭제

##### 행 삭제

```{r}
# 9행 삭제
df <- df[-9, ]
df

# score 가 80이하 삭제 
df <- df[!df$score < 80, ]
df
```

##### 열 삭제

```{r}
# salary3 변수(열) 삭제
df$salary3 <- NULL
df

# 5열(salary)과 6열(salary2) 삭제
df <- df[, -(5:6)]
df
```

### 기타

#### 데이터 프레인 컬럼명 추출

```{r}
names(df)
```

#### 데이터 프레임 컬럼(열) 개수

```{r}
# 컬럼의 갯수 보기 ncol == length
ncol(df); length(df)
```

#### 데이터 프레임 행 개수

```{r}
nrow(df)
```

#### 데이터 프레임 연산

```{r}
# rowSums(), colSums(), colMeans(), rowMeans()
# 연산을 위해 숫자가 아인 컬럼 제거 (1열 name, 3열 sex)
df2 <- df[, -c(1, 3)]
df2
colMeans(df2)
```


## R 리스트 List

리스트(List)는 벡터, 행렬, 배열, 데이터 프레임 등과 같은 서로 다른 구조의 객체들을 하나로 묶은 것입니다. 기차처럼 이어서 묶어 놓은 것을 상상하면 될 것입니다. 

### 리스트 만들기

숫자 벡터, 문자벡터, 행렬, 데이터 프레임을 하나로 묶어서 mylist라는 변수에 할당하겠습니다.

```{r}
# 숫자 벡터
numvec <- seq(1, 10, by = 2)
# 문자 벡터
strvec <- c("대한", "민국", "행정")
# 행렬
mtx <- matrix(1:12, ncol = 3)

# 데이터 프레임
name <- c("유재석", "홍진영", "송가인", "강호동", "이영자", "김종민", "김연아")
age <- c(24, 28, 31, 25, 27, 22, 29)
sex <- c("남", "여", "여", "남", "여", "남", "여")
score <- c(90, 80, 85, 75, 95, 80, 70)
df <- data.frame(name, age, sex, score, stringsAsFactors = FALSE)

# 리스트 만들기 : 리스트 요소에 이름이 지정되지 않음
mylist <- list(numvec, strvec, mtx, df)
mylist

# 리스트 요소에 이름을 지정하여 리스트 만들기
mylist <- list(numvec = numvec, 
               strvec = strvec, 
               mtx = mtx, 
               df = df)
mylist
```

#### 리스트 요소 이름 지정 또는 변경하기

```{r}
names(mylist) <- c("numbers", "strings", "matrix_num", "df_score")
mylist
```



### 리스트 구조 보기

```{r}
# 리스트 구조 보기
str(mylist)
```

```{r}
# 리스트에 있는 객체(요소)의 개수
length(mylist)
```

```{r}
# 리스트 요소의 이름 추출
names(mylist)
```

### 리스트에서 데이터 추출

#### 특정 위치에 있는 데이터 추출하기

```{r}
# 행렬(matrix_num) 요소 데이터 추출
# 리스트와 요소사이에 $기호가 사용됨
mylist$matrix_num
```

```{r}
# 위치 번호 대신 요소 이름을 사용하여 추출
# []는 리스트의 하위 요소를 보여주는 것임. 타입은 list 
mylist["matrix_num"]; typeof(mylist["matrix_num"])

# [[]]는 리스트 하위 요소의 데이터를 보여줌. 타입은 integer
mylist[["matrix_num"]]; typeof(mylist[["matrix_num"]])
```

```{r}
# df$matrix_num 대신 아래처럼 사용 가능 - 3번째 요소
# mylist$numbers == mylist[["numbers"]] == mylist[[1]]
mylist$numbers; mylist[["numbers"]]; mylist[[1]]
```

```{r}
# 리스트의 strings 요소의 3번째 데이터 추출
# 아래 3가지 방식이 동일함
s1 <- mylist$strings[3]
s2 <- mylist[["strings"]][3]
s3 <- mylist[[2]][3]
s1; s2; s3
```

```{r}
# 리스트의 요소인 df_score 데이터 프레임의 name 변수 데이터 추출
mylist$df_score$name
```

### 리스트의 데이터 수정

```{r}
# 리스트의 strings 요소의 3번째 데이터를 "정부"로 수정
mylist$strings[3] <- "정부"
mylist$strings
```

### 리스트 구조 수정

#### 리스트 요소 추가
```{r}
mylist$new_list <- 1:5
str(mylist)
```

#### 리스트 요소 제거
```{r}
mylist$new_list <- NULL
str(mylist)
```

#### 리스트 병합
```{r}
list1 <- list(x1 = 1:5,
              x2 = LETTERS)
list2 <- list(y1 = 11:17,
              y2 = letters)

# 2개 리스트 병합
mlist <- c(list1, list2)
mlist
```

### 리스트를 벡터로 변환

```{r}
# 리스트를 벡터로 변환
unlist(list1)
```

```{r}
# 리스트 요소를 벡터로 변환
unlist(mylist$numbers)
```
